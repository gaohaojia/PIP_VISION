# [18.04+10.2+8.0.6]NX环境配置全过程及踩坑记录
## 1.刷系统
- 去Nvidia官网下载Jetpack 4.6.0版本，其包含Ubuntu18.04、Cuda10.2和TensorRT8.0.6。
- 用软件将其flash进SD卡，[下载网站](https://www.balena.io/etcher/)。
- 插入NX中，启动。
***
**以下为可能遇到的坑。**
- 进入系统后，报空间不足。\
右上角输入“disks”，进入第一个软件，选择刚才写入的SD卡（可根据容量大小判断），**将软件全屏**（否则内容显示不全）。选中Filesystem，点击下面的设置，选择resize，拉到最大，保存。
## 2.配置Cuda
命令行输入
```bash
sudo apt-get update
sudo apt-get install cuda-toolkit-10.2 
```
安装完成后配置Cuda
```bash
vi ~/.bashrc
```
写入以下内容。
```bash
export PATH=/usr/local/cuda-10.2/bin${PATH:+:${PATH}}
export LD_LIBRARY_PATH=/usr/local/cuda-10.2/lib64${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}}
export CUDA_ROOT=/usr/local/cuda
```
保存并关闭，刷新。
```bash
source ~/.bashrc
```
## 3.降级cudnn
分别安装三个8.0.0.180版本cudnn的包（找队长拷）。
```bash
cd /usr/include && sudo cp cudnn.h /usr/local/cuda/include
cd /usr/lib/aarch64-linux-gnu && sudo cp libcudnn* /usr/local/cuda/lib64
sudo chmod 777 /usr/local/cuda/include/cudnn.h /usr/local/cuda/lib64/libcudnn*
cd /usr/local/cuda/lib64
sudo ln -sf libcudnn.so.8.0.0 libcudnn.so.8
sudo ln -sf libcudnn_ops_train.so.8.0.0 libcudnn_ops_train.so.8
sudo ln -sf libcudnn_ops_infer.so.8.0.0 libcudnn_ops_infer.so.8
sudo ln -sf libcudnn_adv_infer.so.8.0.0 libcudnn_adv_infer.so.8
sudo ln -sf libcudnn_cnn_infer.so.8.0.0 libcudnn_cnn_infer.so.8
sudo ln -sf libcudnn_cnn_train.so.8.0.0 libcudnn_cnn_train.so.8
sudo ln -sf libcudnn_adv_train.so.8.0.0 libcudnn_adv_train.so.8
sudo ldconfig
```
## 4.打开port权限
```bash
sudo systemctl stop nvgetty.service
sudo systemctl disable nvgetty.service
cd /etc/udev/rules.d/
sudo vim 99-serial.rules
```
写入以下内容。
```bash
KERNEL=="ttyTHS0", MODE="0666"
```
保存，之后运行以下命令。
```bash
sudo udevadm control --reload
sudo chmod 777 /dev/ttyTHS0
```
重启。
## 5.安装pip3
```bash
sudo apt-get install python3-pip
```
## 6.pip永久换源
```bash
mkdir -p ~/.pip/
vim ~/.pip/pip.conf
```
写入以下内容。
```bash
[global]
index-url = https://pypi.tuna.tsinghua.edu.cn/simple
trusted-host = pypi.tuna.tsinghua.edu.cn
```
## 7.torch和torchvision环境配置
安装依赖项
```bash
sudo apt-get install libjpeg-dev zlib1g-dev libpython3-dev libavcodec-dev libavformat-dev libswscale-dev
```
去[Nvidia开发论坛](https://forums.developer.nvidia.com/t/pytorch-for-jetson/72048)下载1.7.0的Pytorch，然后安装。\
因为官方没有arm64架构的torchvision，因此需要从github下载源码并自行编译。
```bash
git clone --branch v0.8.0 https://github.com/pytorch/vision torchvision
cd torchvision
export BUILD_VERSION=0.8.0
pip3 install 'pillow<7'
sudo python3 setup.py install --user
```
十几分钟的等待......（运气不好可能给几十分钟）
## 8.配置海康威视摄像头驱动
去[官网](https://www.mindvision.com.cn/uploadfiles/SDK/linuxSDK_V2.1.0.37.tar.gz)下载驱动，然后运行install.sh。
## 9.安装其他包文件
进入PIP_VISION文件夹，右键打开terminal。
```bash
pip3 install -r rerequirements.txt
```